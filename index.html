<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <!-- ====== SEO / OGP ====== -->
  <title>ä½“é‡ãƒ¡ãƒ¢ | weight.kkpwebninja.com</title>
  <meta name="description" content="ä½“é‡ã ã‘æ¯æ—¥ã‚µãƒƒã¨è¨˜éŒ²ã€‚è»½é‡ã‚°ãƒ©ãƒ•ï¼†XæŠ•ç¨¿ã€‚ãƒ‡ãƒ¼ã‚¿ã¯ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚">
  <link rel="canonical" href="https://weight.kkpwebninja.com/">

  <meta property="og:type" content="website">
  <meta property="og:title" content="ä½“é‡ãƒ¡ãƒ¢ | weight.kkpwebninja.com">
  <meta property="og:description" content="ä½“é‡ã ã‘æ¯æ—¥ã‚µãƒƒã¨è¨˜éŒ²ã€‚è»½é‡ã‚°ãƒ©ãƒ•ï¼†XæŠ•ç¨¿ã€‚">
  <meta property="og:url" content="https://weight.kkpwebninja.com/">
  <meta property="og:image" content="https://weight.kkpwebninja.com/weight.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ä½“é‡ãƒ¡ãƒ¢ | weight.kkpwebninja.com">
  <meta name="twitter:description" content="ä½“é‡ã ã‘æ¯æ—¥ã‚µãƒƒã¨è¨˜éŒ²ã€‚è»½é‡ã‚°ãƒ©ãƒ•ï¼†XæŠ•ç¨¿ã€‚">
  <meta name="twitter:image" content="https://weight.kkpwebninja.com/weight.png">

  <meta name="theme-color" content="#ffffff" />

  <!-- ====== Google Analytics (GA4) ====== -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2LM85GJN0L"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-2LM85GJN0L'); // ã„ã¤ã‚‚ã®ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹
  </script>

  <style>
    :root{--bg:#fff;--fg:#0f172a;--muted:#6b7280;--card:#f8fafc;--border:#e5e7eb;--accent:#2563eb;--danger:#ef4444}
    @media (prefers-color-scheme: dark){
      :root{--bg:#0b0f14;--fg:#e5e7eb;--muted:#9ca3af;--card:#0f1720;--border:#1f2937;--accent:#60a5fa;--danger:#f87171}
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Noto Sans JP","Yu Gothic",Meiryo,sans-serif}
    .wrap{max-width:680px;margin:0 auto;padding:16px}
    h1{font-size:1.2rem;margin:6px 0}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;margin:12px 0}
    label{font-size:.9rem;color:var(--muted)}
    input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#fff0;color:var(--fg)}
    input[type="date"]{padding:10px 12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .row{display:flex;gap:8px;align-items:center}
    .grow{flex:1}
    .btn{display:inline-block;width:100%;text-align:center;padding:12px;border-radius:12px;border:1px solid var(--border);background:var(--bg);color:var(--fg);font-weight:700;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn-ghost{background:var(--card)}
    .tiny{font-size:.8rem;color:var(--muted)}
    canvas{width:100%;height:110px;display:block}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 6px;border-bottom:1px solid var(--border);font-size:.95rem}
    th{text-align:left;color:var(--muted)}
    td.right{text-align:right}
    tr:hover{background:rgba(125,125,125,.06)}
    footer{text-align:center;margin:18px 0 40px;color:var(--muted)}
    #footer a{color:var(--accent);font-weight:700;text-decoration:none}
  </style>
</head>
<body>
<div class="wrap">
  <h1>ä½“é‡ãƒ¡ãƒ¢ ultra âš–ï¸</h1>

  <!-- å…¥åŠ› -->
  <section class="card">
    <div class="grid">
      <div>
        <label for="date">æ—¥ä»˜</label>
        <input type="date" id="date">
      </div>
      <div>
        <label for="weight">ä½“é‡ (kg)</label>
        <input type="number" id="weight" inputmode="decimal" step="0.1" placeholder="ä¾‹: 68.5">
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <button class="btn btn-primary grow" id="saveBtn">ä¿å­˜</button>
      <button class="btn btn-ghost" id="shareBtn" style="min-width:120px;">Xã«æŠ•ç¨¿</button>
    </div>
    <div class="tiny" id="hint"></div>
  </section>

  <!-- ã‚°ãƒ©ãƒ• -->
  <section class="card">
    <strong>ã‚°ãƒ©ãƒ•ï¼ˆç›´è¿‘30ï¼‰</strong>
    <canvas id="chart"></canvas>
  </section>

  <!-- å±¥æ­´ï¼ˆæœ€å°ï¼‰ -->
  <section class="card">
    <strong>å±¥æ­´</strong>
    <div style="overflow-x:auto;margin-top:8px;">
      <table>
        <thead><tr><th>æ—¥ä»˜</th><th class="right">ä½“é‡</th><th>å‰Šé™¤</th></tr></thead>
        <tbody id="tbody"><!-- JSã§æç”» --></tbody>
      </table>
    </div>
    <p class="tiny">è¡Œã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨å…¥åŠ›æ¬„ã«èª­ã¿è¾¼ã¿ã¾ã™ã€‚</p>
  </section>

  <footer>
    <div class="tiny">ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ç«¯æœ«ã ã‘ã«ä¿å­˜ï¼ˆlocalStorageï¼‰ã€‚</div>
    <div id="footer">
      X <a href="https://x.com/kkp_webninja" target="_blank">@kkp_webninja</a><br>
      ğŸ¯ <a href="https://kkpwebninja.com" target="_blank">webå¿è€…ã®æœ¬ä¸¸</a><br>
    </div>
  </footer>
</div>

<script>
/* ==================================================
   ä½“é‡ãƒ¡ãƒ¢ ultraï¼ˆweight.kkpwebninja.comï¼‰
   - æ—¥æœ¬æ™‚é–“ã®ä»Šæ—¥: todayJP()
   - localStorageã‚­ãƒ¼: weights_ultra_v1
   - æ©Ÿèƒ½: ä¿å­˜ / 30ä»¶ã‚°ãƒ©ãƒ•(Canvas) / å±¥æ­´ / XæŠ•ç¨¿(intent)
   - GAã‚¤ãƒ™ãƒ³ãƒˆ: ä¿å­˜ãƒ»å…±æœ‰
================================================== */

const $ = s => document.querySelector(s);

// æ—¥æœ¬æ™‚é–“ã§ YYYY-MM-DDï¼ˆUTCã‚ºãƒ¬å¯¾ç­–ï¼‰
function todayJP(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

// æ•°å€¤ãƒ‘ãƒ¼ã‚¹
const num = v => { const n = Number(v); return isNaN(n) ? null : n; };

// ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆv1ï¼‰
const STORAGE_KEY = "weights_ultra_v1";
const load = () => { try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); } catch { return []; } };
const save = arr => localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
const uuid = () => crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random();

// è¦ç´ 
const dateEl   = $("#date");
const weightEl = $("#weight");
const hintEl   = $("#hint");
const tbody    = $("#tbody");
const canvas   = $("#chart");

// åˆæœŸæ—¥ä»˜ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
dateEl.value = todayJP();

// æ—¢ã«ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°è¡¨ç¤º
{
  const rec = load().find(r => r.date === dateEl.value);
  if (rec) weightEl.value = rec.weight;
}

// ä¿å­˜
$("#saveBtn").addEventListener("click", ()=>{
  const d = dateEl.value || todayJP();
  const w = num(weightEl.value);
  if (w == null){ hint("ä½“é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }

  const arr = load();
  const i = arr.findIndex(r => r.date === d);
  if (i >= 0) arr[i] = {...arr[i], weight: w};
  else arr.push({id: uuid(), date: d, weight: w});
  arr.sort((a,b)=> a.date < b.date ? 1 : -1); // æ–°â†’æ—§
  save(arr);

  renderTable(); renderChart();
  hint("ä¿å­˜ã—ã¾ã—ãŸã€‚");

  // GAã‚¤ãƒ™ãƒ³ãƒˆï¼ˆä»»æ„ï¼‰
  if (typeof gtag === 'function') {
    gtag('event','save_weight',{ value: Number(weightEl.value)||0, date: d });
  }
});

// Xã«æŠ•ç¨¿ï¼ˆTwitter Intentï¼‰
$("#shareBtn").addEventListener("click", ()=>{
  const arr = load().sort((a,b)=> a.date < b.date ? 1 : -1); // æ–°â†’æ—§
  if (!arr.length){ hint("ã¾ãšä½“é‡ã‚’ä¿å­˜ã—ã¦ãã ã•ã„ã€‚"); return; }
  const todayRec = arr[0];

  const text = `ä»Šæ—¥ã®ä½“é‡ ${todayRec.weight}kgï¼ˆ${todayRec.date}ï¼‰\n#ä½“é‡è¨˜éŒ² #ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ`;
  const shareUrl = "https://twitter.com/intent/tweet"
    + "?text=" + encodeURIComponent(text)
    + "&url="  + encodeURIComponent("https://weight.kkpwebninja.com/");

  if (typeof gtag === 'function') {
    gtag('event','share_on_x',{ date: todayRec.date, weight: todayRec.weight });
  }

  window.open(shareUrl, "_blank", "noopener,noreferrer");
});

// å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
function renderTable(){
  const arr = load();
  tbody.innerHTML = "";
  for (const r of arr){
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="pick" data-id="${r.id}" style="cursor:pointer">${r.date}</td>
      <td class="right">${Number(r.weight).toFixed(1)}</td>
      <td><button class="btn" data-del="${r.id}" style="padding:6px 10px;color:var(--danger)">å‰Šé™¤</button></td>
    `;
    tbody.appendChild(tr);
  }
}
tbody.addEventListener("click",(e)=>{
  const del = e.target.closest("button")?.dataset?.del;
  if (del){
    if (confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
      const arr = load().filter(x => x.id !== del);
      save(arr); renderTable(); renderChart();
    }
    return;
  }
  const id = e.target.closest(".pick")?.dataset?.id;
  if (id){
    const r = load().find(x => x.id === id);
    if (r){ dateEl.value = r.date; weightEl.value = r.weight; }
  }
});

// ã‚°ãƒ©ãƒ•ï¼ˆç›´è¿‘30ä»¶ï¼‰
function renderChart(){
  const ctx = canvas.getContext("2d");
  const W = canvas.clientWidth * devicePixelRatio;
  const H = 110 * devicePixelRatio;
  canvas.width = W; canvas.height = H; ctx.clearRect(0,0,W,H);

  const data = load().slice().reverse().slice(-30); // å¤â†’æ–° ã§30ä»¶
  if (!data.length){
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue("--muted");
    ctx.font = `${12*devicePixelRatio}px system-ui`;
    ctx.fillText("è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“", 8*devicePixelRatio, 60*devicePixelRatio);
    return;
  }

  const vals = data.map(d=>Number(d.weight));
  const min = Math.min(...vals), max = Math.max(...vals);
  const pad = 8 * devicePixelRatio;
  const xStep = (W - pad*2) / Math.max(1, data.length-1);
  const yScale = (H - pad*2) / ((max - min) || 1);

  // å¹³å‡ã®ç‚¹ç·š
  const avg = vals.reduce((a,b)=>a+b,0) / vals.length;
  ctx.strokeStyle = "rgba(125,125,125,.3)";
  ctx.setLineDash([4*devicePixelRatio,4*devicePixelRatio]);
  ctx.beginPath();
  const yAvg = H - pad - (avg - min) * yScale;
  ctx.moveTo(pad, yAvg); ctx.lineTo(W - pad, yAvg); ctx.stroke();
  ctx.setLineDash([]);

  // æŠ˜ã‚Œç·š
  ctx.lineWidth = 2 * devicePixelRatio;
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue("--accent");
  ctx.beginPath();
  data.forEach((d,i)=>{
    const x = pad + i * xStep;
    const y = H - pad - (Number(d.weight) - min) * yScale;
    if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

// ãƒ’ãƒ³ãƒˆè¡¨ç¤º
function hint(msg){
  hintEl.textContent = msg;
  setTimeout(()=> hintEl.textContent = "", 1200);
}

// åˆæœŸæç”» & ç”»é¢å›è»¢å¯¾å¿œ & æ—¥ä»˜å¤‰æ›´èª­ã¿è¾¼ã¿
function init(){ renderTable(); renderChart(); }
init();
addEventListener("resize", renderChart);
dateEl.addEventListener("change", ()=>{
  const r = load().find(x => x.date === dateEl.value);
  weightEl.value = r ? r.weight : "";
});
</script>
</body>
</html>
